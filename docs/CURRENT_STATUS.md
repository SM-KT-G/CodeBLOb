# í˜„ì¬ í”„ë¡œì íŠ¸ ìƒíƒœ (2025-11-17)

> ìµœì‹  êµ¬í˜„ í˜„í™©ê³¼ ë‹¤ìŒ ì‘ì—… ê³„íšì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆëŠ” ë¬¸ì„œì…ë‹ˆë‹¤.

---

## âœ… ì™„ë£Œëœ ì£¼ìš” ê¸°ëŠ¥

### 1. RAG v1.1 Parent-Child ì•„í‚¤í…ì²˜
- **ì„ë² ë”© 100% ì™„ë£Œ** (2025-11-07)
  - Parents: 377,263ê°œ (ë¬¸ì„œ ìš”ì•½)
  - Children: 2,202,565ê°œ (QA ì²­í¬, í‰ê·  5.8ê°œ/ë¬¸ì„œ)
  - ëª¨ë¸: intfloat/multilingual-e5-small (384d)
  - ì²˜ë¦¬ ì‹œê°„: 2ì‹œê°„ 54ë¶„, ì†ë„: 35.97 files/sec
  - M4 GPU (MPS) ê°€ì† ì‚¬ìš©

### 2. ê²€ìƒ‰ ì‹œìŠ¤í…œ
- **Retriever v1.1**
  - ì§ì ‘ SQL ì¿¼ë¦¬ (PGVector <=> ì—°ì‚°ì)
  - Parent-Child JOIN
  - í‰ê·  ìœ ì‚¬ë„: 90%+ (0.90~0.92)

- **Metadata Filtering**
  - domain, area í•„í„°ë§
  - ë³µí•© í•„í„° ì§€ì›
  - ìµœê³  ìœ ì‚¬ë„: 0.91

- **Query Expansion**
  - JSON ì„¤ì • ê¸°ë°˜ ë³€í˜• ìƒì„±
  - ë³€í˜•ë³„ ì§€í‘œ ë¡œê¹…
  - Redis TTL ìºì‹œ

- **Parent Context ì˜µì…˜**
  - `parent_context` í”Œë˜ê·¸ë¡œ ìš”ì•½ í¬í•¨/ì œì™¸

### 3. í†µí•© ì±„íŒ… ì‹œìŠ¤í…œ (2025-11-17)
- **Structured Outputs**
  - ItineraryDay, ItineraryData, ItineraryStructuredResponse ìŠ¤í‚¤ë§ˆ
  - OpenAI beta.chat.completions.parse
  - 100% JSON ë³´ì¥

- **ChatHistoryManager**
  - MariaDB ì±„íŒ… ê¸°ë¡ ì˜êµ¬ ì €ì¥
  - JSON LONGTEXT (JSON_VALID CHECK)
  - save_message(), get_history(), get_recent_context(), delete_session()

- **UnifiedChatHandler**
  - Function Callingìœ¼ë¡œ ì˜ë„ ìë™ íŒŒì•…
  - _handle_general_chat(): ì¼ë°˜ ëŒ€í™”
  - _handle_search_places(): RAG ê²€ìƒ‰
  - _handle_create_itinerary(): ì—¬í–‰ ì¼ì • ìƒì„±

- **í†µí•© ì—”ë“œí¬ì¸íŠ¸**
  - POST /chat: ì¼ë°˜ ëŒ€í™” + RAG + ì—¬í–‰ ì¼ì •
  - Function Calling ìë™ ê°ì§€ ë° ì‹¤í–‰
  - lifespanì—ì„œ ì´ˆê¸°í™” ë° ì •ë¦¬

---

## ğŸ“Š í˜„ì¬ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FastAPI Backend                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST /chat (í†µí•© ì±„íŒ…)                  â”‚
â”‚  - UnifiedChatHandler                   â”‚
â”‚  - Function Calling ìë™ ê°ì§€            â”‚
â”‚  - ChatHistoryManager (MariaDB)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST /rag/query (RAG ê²€ìƒ‰)             â”‚
â”‚  - Query Expansion                      â”‚
â”‚  - Metadata Filtering                   â”‚
â”‚  - Parent Context                       â”‚
â”‚  - Redis ìºì‹œ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL + pgvector                  â”‚
â”‚  - tourism_parent (377,263)             â”‚
â”‚  - tourism_child (2,202,565)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  MariaDB                                â”‚
â”‚  - chat_history (ì±„íŒ… ê¸°ë¡)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ë‹¤ìŒ ì‘ì—… ê³„íš

### ì¦‰ì‹œ (ì´ë²ˆ ì£¼)
1. **ë¬¸ì„œ ì •ë¦¬ ì™„ë£Œ**
   - âœ… ì¤‘ë³µ ë¬¸ì„œ ì‚­ì œ (WORK_STATUS.md, plan.md, í”„ë¡œì íŠ¸_ê³„íšì„œ.md)
   - ğŸ”„ í•µì‹¬ ë¬¸ì„œ ìµœì‹ í™”
   - â³ Git ì»¤ë°‹

2. **MariaDB ì„¤ì • ë° í…ŒìŠ¤íŠ¸**
   - Docker Compose ì‹¤í–‰
   - chat_history í…Œì´ë¸” ìƒì„± í™•ì¸
   - í†µí•© ì±„íŒ… ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ (4ê°œ í…ŒìŠ¤íŠ¸ íŒŒì¼)

3. **í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ì¤€ë¹„**
   - Node.js ì—°ë™ ê°€ì´ë“œ ì—…ë°ì´íŠ¸
   - API ìŠ¤í™ ìµœì‹ í™”

### ë‹¤ìŒ ì£¼
1. **ì„±ëŠ¥ ìµœì í™”**
   - Query Expansion latency ë¶„ì„
   - Redis ìºì‹œ íš¨ìœ¨ ì¸¡ì •
   - DB ì¿¼ë¦¬ ìµœì í™”

2. **ìš´ì˜ ë¬¸ì„œí™”**
   - ë°°í¬ ê°€ì´ë“œ
   - ëª¨ë‹ˆí„°ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸
   - ì¥ì•  ëŒ€ì‘ ì ˆì°¨

---

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

| í•­ëª© | í˜„ì¬ ê°’ | ëª©í‘œ |
|------|---------|------|
| RAG í‰ê·  ìœ ì‚¬ë„ | 0.90~0.92 | 0.90+ âœ… |
| RAG ê²€ìƒ‰ ì†ë„ | ~200ms | <300ms âœ… |
| JSON íŒŒì‹± ì„±ê³µë¥  | 100% | 100% âœ… |
| ë©”íƒ€ë°ì´í„° ì •í™•ë„ | 100% | 100% âœ… |

---

## ğŸ—‚ï¸ ë°ì´í„° í˜„í™©

### ë„ë©”ì¸ë³„ ë¶„í¬ (ì´ 377,265ê°œ)
- ìŒì‹ì  (food): 113,383ê°œ (30.1%)
- ì—­ì‚¬ (his): 116,387ê°œ (30.8%)
- ìˆ™ë°• (stay): 67,709ê°œ (17.9%)
- ìì—° (nat): 37,408ê°œ (9.9%)
- ì‡¼í•‘ (shop): 29,005ê°œ (7.7%)
- ë ˆì € (lei): 15,373ê°œ (4.1%)

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- **Backend**: FastAPI + Python 3.10
- **Database**: PostgreSQL + pgvector, MariaDB
- **LLM**: OpenAI GPT-4
- **Embedding**: intfloat/multilingual-e5-small (384d)
- **Cache**: Redis
- **Hardware**: M4 GPU (MPS acceleration)

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [IMPLEMENTATION_TRACKER.md](./IMPLEMENTATION_TRACKER.md) - ìƒì„¸ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [PROJECT_PLAN.md](./PROJECT_PLAN.md) - í”„ë¡œì íŠ¸ ê³„íš ë° ë¡œë“œë§µ
- [RAG_PIPELINE_ARCHITECTURE.md](./RAG_PIPELINE_ARCHITECTURE.md) - RAG ì•„í‚¤í…ì²˜
- [API_INTEGRATION_FOR_NODE.md](./API_INTEGRATION_FOR_NODE.md) - Node.js ì—°ë™
- [REDIS_CACHE_GUIDE.md](./REDIS_CACHE_GUIDE.md) - Redis ìš´ì˜
- [README.md](./README.md) - ë¬¸ì„œ í—ˆë¸Œ

---

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-17  
**ìƒíƒœ**: í†µí•© ì±„íŒ… ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ, ë¬¸ì„œ ì •ë¦¬ ì§„í–‰ ì¤‘
